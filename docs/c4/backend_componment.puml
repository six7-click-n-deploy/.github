@startuml C4_Component_Backend_Refined
left to right direction
skinparam componentStyle rectangle
skinparam linetype ortho
skinparam defaultFontSize 11

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

' =========================
' Adjacent containers
' =========================
Container_Ext(frontend, "Web Frontend", "Vue SPA")
Container_Ext(taskInfra, "Task Infrastructure", "RabbitMQ + Redis", "Queue & Status")
Container_Ext(db, "PostgreSQL Database", "PostgreSQL")

' =========================
' Backend container
' =========================
Container_Boundary(backend, "Backend API\n(FastAPI)") {

    ' Entry point
    Component(api, "API Layer", "REST")

    ' Second column (split vertically)
    together {
        Component(domain, "Domain Services")
        Component(auth, "Auth & RBAC", "JWT")
    }

    ' Third column (split vertically)
    together {
        Component(orchestrator, "Deployment Orchestrator")
        Component(persistence, "Persistence Layer", "ORM")
    }

    ' Exit
    Component(tasks, "Task Interface")

    ' =====================
    ' Internal relations
    ' =====================
    Rel(api, domain, "delegate")
    Rel(api, auth, "auth")

    Rel(domain, orchestrator, "start")
    Rel(domain, persistence, "read/write")

    Rel(orchestrator, tasks, "enqueue")
}

' =========================
' External relations
' =========================
Rel(frontend, api, "HTTPS")
Rel(tasks, taskInfra, "tasks")
Rel(persistence, db, "SQL")

@enduml
